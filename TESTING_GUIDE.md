# 测试指南

## 🔧 重新部署（必须！）

由于修复了核心问题，**必须重新上传云函数**：

1. 在微信开发者工具中
2. 右键点击 `cloudfunctions/generateCard` 文件夹
3. 选择 **"上传并部署：云端安装依赖"**
4. 等待上传完成（看到"上传成功"提示）

## ✅ 测试步骤

### 测试 1：基础功能测试

1. **打开小程序**
   - 点击"编译"按钮
   - 等待小程序加载

2. **选择参数**
   - 城市：上海
   - 天数：2天
   - 目的：亲子遛娃

3. **生成卡片**
   - 点击"3秒出卡"按钮
   - 观察加载状态
   - 等待生成完成

4. **预期结果** ✅
   - 显示"生成成功！"提示
   - 页面下方出现精美的文本卡片
   - 卡片包含完整的行程信息
   - 显示3个操作按钮

### 测试 2：不同参数组合

测试以下组合，确保都能正常生成：

| 城市 | 天数 | 目的 | 预期 |
|------|------|------|------|
| 上海 | 1天 | 亲子遛娃 | ✅ 成功 |
| 上海 | 2天 | 情侣约会 | ✅ 成功 |
| 上海 | 3天 | 朋友小聚 | ✅ 成功 |
| 上海 | 2天 | 美食探店 | ✅ 成功 |

### 测试 3：功能按钮测试

1. **重新生成**
   - 点击"重新生成"按钮
   - 应该生成新的行程（内容可能不同）

2. **保存到相册**
   - 点击"保存到相册"
   - 授权相册权限
   - 检查相册是否保存成功

3. **分享给好友**
   - 点击"分享给好友"
   - 检查分享卡片是否正常

## 🔍 调试检查

### 检查点 1：控制台日志

打开微信开发者工具的控制台，应该看到：

```
开始生成卡片: {city: "上海", days: 2, intent_tag: "亲子遛娃"}
云函数调用成功 {errMsg: "cloud.callFunction:ok", result: {...}}
```

### 检查点 2：云函数日志

在云开发控制台 -> 云函数 -> generateCard -> 日志，应该看到：

```
收到请求参数: {city: "上海", days: 2, intent_tag: "亲子遛娃"}
查询到 X 条活动数据
开始组合行程，活动数量: X, 天数: 2
主菜活动: X个, 配菜活动: X个
行程组合完成，总费用: ¥XXX
准备上传文件: cards/上海_亲子遛娃_...
文件上传成功: cloud://...
```

### 检查点 3：数据库查询

如果显示"暂无相关活动数据"：

1. **检查数据库**
   - 打开云开发控制台 -> 数据库
   - 选择 `activities` 集合
   - 确认有数据（应该有24条）

2. **检查数据格式**
   - 随机打开一条数据
   - 确认 `tags` 字段是**数组**类型
   - 确认包含 "亲子遛娃" 等标签

3. **重新导入数据**
   - 如果数据有问题，删除所有数据
   - 重新导入 `sample_activities_jsonl.json`

## ❌ 常见问题排查

### 问题 1：云函数调用失败

**症状**：提示"调用失败: cloud.callFunction:fail"

**解决方案**：
1. 检查云函数是否已上传
2. 检查云函数名称是否为 `generateCard`
3. 重新上传云函数

### 问题 2：返回数据为空

**症状**：提示"返回数据为空"

**解决方案**：
1. 查看云函数日志
2. 检查云函数是否有错误
3. 确认云函数返回了正确的数据结构

### 问题 3：暂无相关活动数据

**症状**：提示"暂无'上海'的'亲子遛娃'相关活动数据"

**解决方案**：
1. 检查数据库是否有数据
2. 检查 tags 字段是否为数组
3. 重新导入 `sample_activities_jsonl.json`

### 问题 4：显示空白卡片

**症状**：卡片区域显示但内容为空

**解决方案**：
1. 检查控制台是否有错误
2. 检查文件下载是否成功
3. 查看云函数日志确认文件已上传

## 📊 成功标准

测试通过的标准：

- [x] 能够成功调用云函数
- [x] 能够查询到数据库数据
- [x] 能够生成完整的行程
- [x] 能够显示精美的文本卡片
- [x] 卡片包含所有必要信息（城市、天数、目的、行程、费用、提示）
- [x] 重新生成功能正常
- [x] 保存和分享功能正常

## 🎯 预期效果

成功后，您应该看到类似这样的卡片：

```
╔═══════════════════════════════════╗
║        🎉 3秒出卡 🎉              ║
║     智能生成你的专属行程           ║
╚═══════════════════════════════════╝

📍 城市：上海
📅 天数：2天
🎯 目的：亲子遛娃

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📆 第1天行程
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  09:00 | 上海迪士尼乐园
         ⏱ 8小时 | 💰 ¥500
         📝 点亮心中奇梦，开启一段难忘的沉浸式体验
  ...
```

## 📞 需要帮助？

如果测试仍然失败：

1. 查看 `UPDATE_LOG.md` 了解最新更新
2. 查看 `DATA_IMPORT_GUIDE.md` 确认数据导入正确
3. 检查云函数日志和前端控制台
4. 确认所有文件都已保存并重新编译

祝测试顺利！🎉

