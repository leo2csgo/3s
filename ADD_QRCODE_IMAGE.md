# 添加小程序码图片说明

## 📸 准备小程序码图片

### 步骤 1：获取小程序码

有两种方式获取小程序码：

#### 方式 A：从微信公众平台下载
```
1. 登录微信公众平台
2. 进入小程序后台
3. 设置 -> 基本设置 -> 小程序码
4. 下载小程序码图片
5. 重命名为 3s.jpg
```

#### 方式 B：使用现有的小程序码
```
如果已有小程序码图片：
1. 确保图片格式为 jpg 或 png
2. 重命名为 3s.jpg
3. 建议尺寸：280x280 像素
```

### 步骤 2：添加图片到项目

```
1. 在项目根目录创建 miniprogram/images 文件夹
2. 将 3s.jpg 放入 miniprogram/images/ 目录
3. 最终路径：miniprogram/images/3s.jpg
```

### 步骤 3：验证图片路径

项目结构应该是：
```
miniprogram-1/
├── miniprogram/
│   ├── images/
│   │   └── 3s.jpg          ← 小程序码图片
│   ├── pages/
│   │   └── index/
│   │       ├── index.js
│   │       ├── index.wxml
│   │       └── index.wxss
│   └── app.json
└── cloudfunctions/
```

## 🎯 使用效果

### 优化前
- 生成图片后等待 3-5 秒
- 调用云函数生成小程序码
- 下载小程序码图片
- 重新绘制 Canvas
- 转换为最终图片

**总耗时**：5-8 秒

### 优化后
- 直接使用本地小程序码图片
- 一次性绘制完成
- 立即转换为图片

**总耗时**：1-2 秒

## 📝 代码说明

### 修改的代码

**miniprogram/pages/index/index.js**：
```javascript
// 添加小程序码到Canvas（使用本地图片）
addQRCodeToCanvas(qrX, qrY, qrSize) {
  const ctx = wx.createCanvasContext("cardCanvas", this);
  
  // 使用本地小程序码图片
  const qrCodePath = "/images/3s.jpg";
  
  // 绘制小程序码
  ctx.drawImage(qrCodePath, qrX, qrY, qrSize, qrSize);
  
  // 执行绘制
  ctx.draw(false, () => {
    setTimeout(() => {
      this.canvasToImage();
    }, 300);
  });
}
```

### 图片要求

- **格式**：jpg 或 png
- **尺寸**：建议 280x280 像素（会自动缩放到 120x120）
- **文件名**：3s.jpg（必须）
- **路径**：miniprogram/images/3s.jpg

## 🎨 背景功能优化

### 新增功能

1. **背景色作用到整个图片**
   - 之前：背景只是装饰
   - 现在：背景覆盖整个 Canvas

2. **文字颜色自适应**
   - 根据背景色自动调整文字颜色
   - 确保文字清晰可读

3. **自定义背景图片**
   - 点击"自定义图片"
   - 从相册选择图片
   - 立即应用到背景

### 背景配置

每个背景包含：
```javascript
{
  name: "渐变",           // 背景名称
  type: "gradient",       // 类型：gradient 或 image
  color1: "#667eea",      // 渐变起始色
  color2: "#764ba2",      // 渐变结束色
  textColor: "#ffffff",   // 文字颜色
  cardBg: "rgba(255, 255, 255, 0.95)" // 卡片背景色
}
```

### 5种背景

1. **渐变** - 紫蓝渐变
2. **星空** - 深蓝渐变
3. **海洋** - 蓝色渐变
4. **森林** - 绿色渐变
5. **自定义** - 用户上传的图片

## ✅ 测试清单

### 测试小程序码
- [ ] 图片文件已添加到 miniprogram/images/3s.jpg
- [ ] 生成卡片
- [ ] 图片右下角显示小程序码
- [ ] 小程序码清晰可见
- [ ] 生成速度快（1-2秒）

### 测试背景功能
- [ ] 点击"🖼️ 背景"
- [ ] 选择不同的预设背景
- [ ] 背景颜色正确改变
- [ ] 文字清晰可读
- [ ] 点击"自定义图片"
- [ ] 选择相册图片
- [ ] 图片正确显示为背景

## 🐛 常见问题

### Q1: 小程序码不显示？
**A**: 检查图片路径是否正确
```
1. 确认文件在 miniprogram/images/3s.jpg
2. 文件名必须是 3s.jpg（小写）
3. 重新编译小程序
```

### Q2: 小程序码显示模糊？
**A**: 使用更高分辨率的图片
```
建议尺寸：280x280 或更大
格式：jpg 或 png
```

### Q3: 自定义背景不显示？
**A**: 检查图片选择
```
1. 确认已选择图片
2. 查看控制台日志
3. 检查图片格式（jpg/png）
```

### Q4: 背景图片太暗，文字看不清？
**A**: 已自动添加半透明遮罩
```
代码中已添加：
ctx.setFillStyle("rgba(0, 0, 0, 0.2)");
ctx.fillRect(0, 0, canvasWidth, canvasHeight);

可以调整透明度（0.2 改为 0.3 或 0.4）
```

## 📞 需要帮助？

如有问题，请查看：
- 控制台日志
- 图片路径是否正确
- 文件名是否匹配

祝使用愉快！🎉

