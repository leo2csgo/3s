# 快速修复指南

## 🔧 立即执行以下步骤

### 步骤 1：重新上传云函数（必须！）

**原因**：云函数代码已更新，移除了导致错误的 `page` 参数

**操作**：
```
1. 在微信开发者工具左侧文件树中
2. 找到 cloudfunctions/generateQRCode 文件夹
3. 右键点击
4. 选择"上传并部署：云端安装依赖"
5. 等待上传完成（看到"上传成功"提示）
```

**预期结果**：
- 上传成功提示
- 云函数列表中显示 generateQRCode

### 步骤 2：清除缓存

**操作**：
```
1. 点击工具栏"清除缓存"
2. 选择"清除全部缓存"
3. 确认
```

### 步骤 3：重新编译

**操作**：
```
1. 点击"编译"按钮
2. 等待编译完成
```

### 步骤 4：测试小程序码

**操作**：
```
1. 选择：上海 + 2天 + 亲子遛娃
2. 点击"3秒出卡"
3. 等待生成完成
4. 查看图片右下角
```

**预期结果**：
- 控制台显示："小程序码生成成功"
- 图片右下角显示小程序码（不是占位框）

**如果还是失败**：
- 查看控制台日志，找到错误信息
- 查看云函数日志（云开发控制台 -> 云函数 -> generateQRCode -> 日志）

### 步骤 5：测试全屏显示

**操作**：
```
1. 生成卡片后，点击图片
2. 进入全屏模式
3. 尝试上下滑动
4. 检查图片是否完整显示
```

**预期结果**：
- 图片全屏显示
- 可以上下滚动查看完整内容
- 图片比例正确，不失真
- 底部显示"点击关闭 | 长按保存"

## 📊 问题对照表

| 问题 | 原因 | 解决方案 | 状态 |
|------|------|----------|------|
| 小程序码生成失败 | page 参数错误 | 已修复，需重新上传云函数 | ✅ |
| 全屏图片失真 | 样式问题 | 已优化样式 | ✅ |
| 无法滚动 | overflow 设置 | 已改为 scroll | ✅ |

## 🎯 验证成功的标志

### 小程序码
- ✅ 控制台显示："小程序码生成成功: cloud://..."
- ✅ 图片右下角有真实的小程序码
- ✅ 小程序码可以扫描

### 全屏显示
- ✅ 点击图片能全屏
- ✅ 长图可以滚动
- ✅ 图片不失真
- ✅ 提示文字在底部

### 主题和背景
- ✅ 主题选择器是长条卡片
- ✅ 背景选择器正常工作
- ✅ 自定义背景能上传

## ⚠️ 常见错误

### 错误 1：云函数未上传
**症状**：控制台显示"云函数不存在"
**解决**：按步骤1重新上传

### 错误 2：缓存问题
**症状**：修改后没有效果
**解决**：清除缓存并重新编译

### 错误 3：权限问题
**症状**：小程序码生成失败，提示权限错误
**解决**：检查 config.json 中的权限配置

## 📱 真机测试建议

开发者工具和真机可能有差异，建议：

1. **使用真机调试**
   ```
   工具栏 -> 预览 -> 自动预览
   手机扫码
   打开调试
   ```

2. **生成体验版**
   ```
   工具栏 -> 上传
   填写版本号和备注
   在小程序后台设置为体验版
   手机扫码测试
   ```

## 🔍 调试日志检查

### 成功的日志应该是：
```
✅ 开始生成卡片: {city: "上海", days: 2, intent_tag: "亲子遛娃"}
✅ 云函数调用成功
✅ 云函数返回结果: {success: true, ...}
✅ 小程序码生成成功: cloud://...
✅ 图片生成成功: http://tmp/...
```

### 失败的日志：
```
❌ 小程序码生成失败，使用占位图 {success: false, error: "..."}
```

如果看到失败日志，复制完整的 error 信息，查看具体原因。

## 💡 提示

1. **每次修改云函数后都要重新上传**
2. **清除缓存可以解决很多奇怪的问题**
3. **真机测试更准确**
4. **查看云函数日志可以看到服务端的详细信息**

## 📞 需要帮助？

如果按照以上步骤操作后仍有问题：

1. 查看 `TROUBLESHOOTING.md` 获取详细的排查指南
2. 检查云函数日志
3. 截图错误信息
4. 检查网络连接

祝修复顺利！🎉

