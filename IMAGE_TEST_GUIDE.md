# 图片功能测试指南

## 🎯 测试目标

验证图片生成功能是否正常工作。

## ✅ 测试步骤

### 步骤 1：编译运行

1. 保存所有文件
2. 点击"编译"按钮
3. 等待小程序加载完成

### 步骤 2：生成卡片

1. **选择参数**
   - 城市：上海
   - 天数：2天
   - 目的：亲子遛娃

2. **点击生成**
   - 点击"3秒出卡"按钮
   - 观察加载状态

3. **等待完成**
   - 应该显示"生成成功！"提示
   - 页面下方出现卡片展示区

### 步骤 3：查看图片

1. **默认显示**
   - 应该默认显示"🖼️ 图片版"
   - 图片应该在 0.5-1 秒内生成完成

2. **检查图片内容**
   - ✅ 渐变背景（紫蓝到紫色）
   - ✅ 白色圆角卡片
   - ✅ 标题"🎉 3秒出卡 🎉"
   - ✅ 城市、天数、目的信息
   - ✅ 第1天和第2天的行程
   - ✅ 每个活动的时间、名称、时长、费用、描述
   - ✅ 总费用和温馨提示
   - ✅ 底部提示文字

### 步骤 4：切换视图

1. **切换到文字版**
   - 点击"📝 文字版"按钮
   - 应该显示文本内容

2. **切换回图片版**
   - 点击"🖼️ 图片版"按钮
   - 应该显示图片

### 步骤 5：保存功能

1. **保存到相册**
   - 点击"保存到相册"按钮
   - 如果首次使用，会提示授权
   - 授权后应该显示"已保存到相册"
   - 检查手机相册，确认图片已保存

2. **检查保存的图片**
   - 打开手机相册
   - 找到最新保存的图片
   - 确认图片清晰完整

### 步骤 6：分享功能

1. **点击分享**
   - 点击"分享给好友"按钮
   - 应该弹出分享面板
   - 分享卡片应该显示生成的图片

### 步骤 7：重新生成

1. **点击重新生成**
   - 点击"重新生成"按钮
   - 应该生成新的行程
   - 图片应该自动更新

## 🔍 检查点

### 视觉检查

- [ ] 图片背景是渐变色
- [ ] 卡片是白色圆角矩形
- [ ] 文字清晰可读
- [ ] Emoji 显示正常
- [ ] 布局整齐美观
- [ ] 没有文字重叠
- [ ] 没有内容溢出

### 功能检查

- [ ] 图片能正常生成
- [ ] 切换视图正常
- [ ] 保存到相册成功
- [ ] 分享功能正常
- [ ] 重新生成正常

### 性能检查

- [ ] 图片生成速度 < 1秒
- [ ] 切换视图流畅
- [ ] 没有卡顿现象

## ❌ 常见问题

### 问题 1：图片显示空白

**症状**：切换到图片版后，显示"正在生成图片..."但一直不出现

**排查步骤**：
1. 打开控制台，查看是否有错误
2. 检查是否有"图片生成成功"的日志
3. 检查 Canvas 是否正确创建

**解决方案**：
```javascript
// 增加延迟时间
setTimeout(() => {
  this.canvasToImage();
}, 1000); // 改为1秒
```

### 问题 2：图片模糊

**症状**：生成的图片不清晰

**解决方案**：
- 确保 Canvas 尺寸为 750 x 1334
- 确保 quality 设置为 1
- 检查设备像素比

### 问题 3：Emoji 显示异常

**症状**：Emoji 显示为方框或乱码

**解决方案**：
- 这是 Canvas 的已知限制
- 可以替换为文字或使用图片图标

### 问题 4：保存失败

**症状**：点击保存后提示失败

**排查步骤**：
1. 检查是否授权相册权限
2. 查看控制台错误信息
3. 确认图片已生成（cardImagePath 不为空）

**解决方案**：
- 在小程序设置中开启相册权限
- 重新生成卡片后再保存

### 问题 5：文字溢出

**症状**：活动描述太长，超出卡片范围

**当前处理**：
```javascript
// 截断长文本
const desc = activity.description.length > 20
  ? activity.description.substring(0, 20) + '...'
  : activity.description;
```

## 📊 测试用例

### 用例 1：1天行程

- 城市：上海
- 天数：1天
- 目的：美食探店
- **预期**：图片显示1天的行程，布局合理

### 用例 2：2天行程

- 城市：上海
- 天数：2天
- 目的：亲子遛娃
- **预期**：图片显示2天的行程，内容完整

### 用例 3：3天行程

- 城市：上海
- 天数：3天
- 目的：情侣约会
- **预期**：图片显示3天的行程，不溢出

### 用例 4：切换测试

1. 生成卡片
2. 切换到文字版
3. 切换回图片版
4. 重新生成
5. **预期**：所有操作流畅，图片正确更新

## 🎯 验收标准

测试通过需要满足：

- [x] 图片能正常生成
- [x] 图片内容完整清晰
- [x] 视图切换正常
- [x] 保存功能正常
- [x] 分享功能正常
- [x] 重新生成正常
- [x] 没有明显的 bug
- [x] 用户体验良好

## 📸 预期效果

成功后，您应该看到类似这样的图片：

- 顶部：紫蓝色渐变背景
- 中间：白色圆角卡片
- 标题：🎉 3秒出卡 🎉
- 内容：完整的行程信息
- 底部：费用和提示

## 🚀 下一步

测试通过后，可以：

1. 尝试不同的参数组合
2. 测试边界情况（如活动很少的情况）
3. 在真机上测试
4. 收集用户反馈
5. 继续优化图片样式

## 📞 需要帮助？

如果测试遇到问题：

1. 查看 `IMAGE_FEATURE_GUIDE.md` 了解功能详情
2. 查看 `UPDATE_LOG.md` 了解最新更新
3. 检查控制台日志
4. 确认所有文件都已保存

祝测试顺利！🎉

